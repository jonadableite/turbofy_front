# Turbofy - Gateway de Pagamentos - Regras do Projeto

## üéØ Vis√£o Geral

Turbofy √© um gateway de pagamentos completo com dashboard SaaS para gest√£o financeira, cobran√ßas, relat√≥rios e controle de repasses.

## üèóÔ∏è Arquitetura e Padr√µes

### Arquitetura Hexagonal (Ports & Adapters)

- **Domain**: Entidades e regras de neg√≥cio puras (sem depend√™ncias externas)
- **Application**: Casos de uso e servi√ßos de aplica√ß√£o
- **Infrastructure**: Implementa√ß√µes concretas (DB, APIs externas, RabbitMQ)
- **Ports**: Interfaces/contratos que conectam camadas

### Princ√≠pios SOLID

- **S**ingle Responsibility: Cada classe/fun√ß√£o tem uma √∫nica responsabilidade
- **O**pen/Closed: Aberto para extens√£o, fechado para modifica√ß√£o
- **L**iskov Substitution: Subtipos devem ser substitu√≠veis por seus tipos base
- **I**nterface Segregation: Interfaces espec√≠ficas ao inv√©s de gen√©ricas
- **D**ependency Inversion: Depender de abstra√ß√µes, n√£o de implementa√ß√µes

### Clean Code

- Nomes descritivos e significativos
- Fun√ß√µes pequenas e focadas
- Evitar duplica√ß√£o (DRY)
- Coment√°rios apenas quando necess√°rio (c√≥digo auto-explicativo)
- Tratamento de erros expl√≠cito

## üîí Type Safety

### TypeScript Strict

- **NUNCA usar `any`** - Sempre tipar explicitamente
- Usar `unknown` quando o tipo √© desconhecido
- Preferir tipos espec√≠ficos sobre gen√©ricos amplos
- Validar dados de entrada com Zod
- Usar type guards quando necess√°rio

### Exemplo de Anti-pattern (N√ÉO FAZER):

```typescript
// ‚ùå ERRADO
function processPayment(data: any) {
  return data.amount * 1.1;
}

// ‚úÖ CORRETO
function processPayment(data: PaymentRequest): PaymentResponse {
  return {
    amount: data.amount * 1.1,
    // ...
  };
}
```

## üìÅ Estrutura de Diret√≥rios

### Backend (`backend/`)

```
src/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ entities/          # Entidades de dom√≠nio puras
‚îÇ   ‚îú‚îÄ‚îÄ value-objects/     # Value objects
‚îÇ   ‚îî‚îÄ‚îÄ repositories/      # Interfaces de reposit√≥rios (ports)
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îú‚îÄ‚îÄ use-cases/         # Casos de uso
‚îÇ   ‚îú‚îÄ‚îÄ services/          # Servi√ßos de aplica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ dto/               # Data Transfer Objects
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ database/          # Implementa√ß√£o Prisma
‚îÇ   ‚îú‚îÄ‚îÄ messaging/         # RabbitMQ
‚îÇ   ‚îú‚îÄ‚îÄ external/          # APIs externas (bancos, gateways)
‚îÇ   ‚îî‚îÄ‚îÄ http/              # Express, rotas, middlewares
‚îî‚îÄ‚îÄ ports/
    ‚îú‚îÄ‚îÄ repositories/      # Interfaces de reposit√≥rios
    ‚îî‚îÄ‚îÄ services/         # Interfaces de servi√ßos externos
```

### Frontend (`frontend/`)

```
src/
‚îú‚îÄ‚îÄ app/                   # Next.js App Router
‚îú‚îÄ‚îÄ components/            # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ ui/               # Componentes Shadcn
‚îÇ   ‚îî‚îÄ‚îÄ features/         # Componentes espec√≠ficos de features
‚îú‚îÄ‚îÄ lib/                   # Utilit√°rios e helpers
‚îú‚îÄ‚îÄ hooks/                 # Custom hooks
‚îú‚îÄ‚îÄ types/                 # TypeScript types
‚îî‚îÄ‚îÄ services/              # API clients
```

## üõ†Ô∏è Tecnologias e Ferramentas

### Backend

- **Runtime**: Node.js com TypeScript
- **ORM**: Prisma (PostgreSQL)
- **Mensageria**: RabbitMQ (amqplib)
- **Valida√ß√£o**: Zod
- **Framework**: Express
- **IaC**: SST (Serverless Stack)

### Frontend

- **Framework**: Next.js 16+ (App Router)
- **UI Library**: React 19+
- **Styling**: TailwindCSS v4
- **Components**: Shadcn/ui, Aceternity UI, Magic UI
- **Type Safety**: TypeScript strict

### Infraestrutura

- **IaC**: SST
- **Database**: PostgreSQL (via Prisma)
- **Message Queue**: RabbitMQ
- **Deployment**: AWS (via SST)

## üíº Funcionalidades Principais

### Dashboard SaaS (Propriet√°rios)

- Visualiza√ß√£o de lucro e receitas
- Relat√≥rios financeiros detalhados
- An√°lise de taxas e comiss√µes
- Concilia√ß√£o banc√°ria
- Controle de split de pagamentos

### Interface Cliente

- Cria√ß√£o de cobran√ßas (Pix, Boleto)
- Relat√≥rios e extratos
- Gerenciamento de chaves Pix
- Gerenciamento de boletos
- Acompanhamento de taxas

### Fluxo Financeiro

- Recebimento de pagamentos
- Split de pagamentos autom√°tico
- Repasse para clientes
- Concilia√ß√£o banc√°ria autom√°tica
- Controle de taxas e comiss√µes

## üìù Conven√ß√µes de C√≥digo

### Nomenclatura

- **Classes**: PascalCase (`PaymentService`, `UserRepository`)
- **Fun√ß√µes/M√©todos**: camelCase (`createPayment`, `processRefund`)
- **Constantes**: UPPER_SNAKE_CASE (`MAX_RETRY_ATTEMPTS`)
- **Interfaces/Types**: PascalCase com prefixo `I` opcional (`IPayment`, `PaymentRequest`)
- **Arquivos**: kebab-case (`payment-service.ts`, `user-repository.ts`)

### Estrutura de Arquivos

- Um arquivo por classe/entidade principal
- Exports nomeados preferidos sobre default exports
- Barrels (`index.ts`) para facilitar imports

### Tratamento de Erros

- Usar classes de erro customizadas
- Sempre tipar erros
- Logs estruturados
- N√£o expor detalhes internos em respostas p√∫blicas

### Valida√ß√£o

- Validar TODOS os inputs com Zod
- Validar em m√∫ltiplas camadas (DTO, Domain, Application)
- Mensagens de erro claras e espec√≠ficas

## üîÑ Mensageria (RabbitMQ)

### Padr√µes

- Usar exchanges e queues nomeadas
- Implementar retry logic
- Dead letter queues para falhas
- Mensagens tipadas com TypeScript
- Idempot√™ncia nas opera√ß√µes

### Eventos Principais

- `payment.created`
- `payment.processed`
- `payment.failed`
- `split.executed`
- `reconciliation.completed`

## üóÑÔ∏è Banco de Dados (Prisma)

### Conven√ß√µes

- Migrations versionadas e descritivas
- Seeds para dados iniciais
- Indexes em campos de busca frequente
- Rela√ß√µes bem definidas
- Soft deletes quando aplic√°vel

### Performance

- Queries otimizadas (evitar N+1)
- Usar `select` para campos espec√≠ficos
- Pagina√ß√£o em listagens
- Transa√ß√µes para opera√ß√µes cr√≠ticas

## üé® Frontend (React/Next.js)

### Componentes

- Componentes funcionais com hooks
- Server Components quando poss√≠vel
- Client Components apenas quando necess√°rio
- Props tipadas com TypeScript
- Evitar prop drilling (usar Context quando necess√°rio)

### Styling

- TailwindCSS para estiliza√ß√£o
- Shadcn/ui para componentes base
- Aceternity UI e Magic UI para anima√ß√µes/efeitos
- Design system consistente
- Responsive design mobile-first

### Estado

- Server State: React Query / SWR
- Client State: useState / useReducer
- Global State: Context API (evitar Redux se poss√≠vel)

## üß™ Testes

### Estrat√©gia

- Unit tests para l√≥gica de neg√≥cio
- Integration tests para casos de uso
- E2E tests para fluxos cr√≠ticos
- Testes de componentes (React Testing Library)

### Cobertura

- M√≠nimo 80% em c√≥digo cr√≠tico
- 100% em regras de neg√≥cio complexas

## üöÄ Deploy e DevOps

### SST (Infrastructure as Code)

- Todos os recursos via SST
- Stacks separados por ambiente
- Vari√°veis de ambiente via SST
- Secrets gerenciados adequadamente

### Ambientes

- `dev`: Desenvolvimento local
- `staging`: Pr√©-produ√ß√£o
- `production`: Produ√ß√£o

## ‚ö†Ô∏è Regras Importantes

1. **NUNCA commitar secrets/credenciais**
2. **Sempre validar inputs** antes de processar
3. **Logs estruturados** para debugging
4. **Documentar decis√µes complexas** em c√≥digo
5. **Revisar c√≥digo** antes de commitar
6. **Manter depend√™ncias atualizadas** (security)
7. **Type-safe em TODAS as opera√ß√µes**
8. **Respeitar a arquitetura hexagonal** - n√£o criar depend√™ncias circulares
9. **Testes para funcionalidades cr√≠ticas** (pagamentos, repasses)
10. **Performance**: Otimizar queries e evitar opera√ß√µes s√≠ncronas pesadas

## üìö Recursos e Refer√™ncias

- [Arquitetura Hexagonal](https://alistair.cockburn.us/hexagonal-architecture/)
- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)
- [Clean Code](https://github.com/ryanmcdermott/clean-code-javascript)
- [Prisma Docs](https://www.prisma.io/docs)
- [SST Docs](https://docs.sst.dev)
- [Next.js Docs](https://nextjs.org/docs)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)

## üéØ Objetivos do Projeto

1. Gateway de pagamentos robusto e escal√°vel
2. Dashboard intuitivo para propriet√°rios
3. Interface clara para clientes
4. Concilia√ß√£o banc√°ria autom√°tica
5. Split de pagamentos eficiente
6. C√≥digo limpo, test√°vel e manuten√≠vel
7. Type-safe em toda a aplica√ß√£o
8. Arquitetura que facilita evolu√ß√£o

---

**Lembre-se**: Qualidade > Velocidade. C√≥digo bem escrito hoje economiza tempo amanh√£.
